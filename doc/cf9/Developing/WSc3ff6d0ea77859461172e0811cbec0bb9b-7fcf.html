<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0022)http://help.adobe.com/ -->
<html lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="lang" content="en-us" />
    <meta name="area" content="livedocs" />
    <title>Adobe&#160;ColdFusion&#160;9 * Example: using nested tags, cfthrow, and cfrethrow</title>
    <link rel="shortcut icon" href="images/ColdFusionLinkIndicator.png" />
    <meta name="book" content="Developing&#160;ColdFusion 9 Applications" />
    <meta name="product" content="ColdFusion" />
    <meta name="keywords" content="" /><!--<PageMap><DataObject type="document"><Attribute name="product" value="ColdFusion"></Attribute><Attribute name="book" value="Developing&#160;ColdFusion 9 Applications"></Attribute><Attribute name="keywords" value=""></Attribute></DataObject></PageMap>-->
    
    <script type="text/javascript" language="Javascript" charset="UTF-8"><!--[CDATA[
        var currentTreeNode = "WSc3ff6d0ea77859461172e0811cbec22c24-7e20.html";
    document.cookie = "topicId=" + "WSc3ff6d0ea77859461172e0811cbec22c24-7e20.html";
// ]]--></script>
<script src="terms.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="help.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script>  <script src="utilities.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="event.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="treeview.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="toc.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script> <script src="swfobject.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script>  <script src="booklist.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script>
<script type="text/javascript">
<!--[CDATA[
var topictype = "topic";
var headId = document.getElementsByTagName("head")[0];         
if (use_ie_6_behavior) {
  var linkId = document.createElement("link");
  linkId.href = "content-ie6.css";
  linkId.rel = "stylesheet";
  linkId.type = "text/css";
  headId.appendChild(linkId);
}
function initRoboHelpDOM() {
  if (use_chm_behavior) {
    hideElement("search");
  }
  if (use_robohelp_behavior) {
    hideElement("search");
    hideElement("productmenu");
    //hideElement("notyourversion");
  }
  if(!use_chc_behavior) {
    //document.getElementById("notyourversion").style.display = "inline";;
  }
}
var dirname = location.pathname.match( /.*\// );    
function setSearchUserPref(){
  if ( document.cookie.indexOf( "ah_searchpref" ) > -1 ) {
    if ( document.cookie.indexOf( dirname ) > 0 ) {
      document.search.gsa.checked = true ;
    }else{
      document.search.gsa.checked = false ;            
    }
  }
}
YAHOO.util.Event.onDOMReady(initRoboHelpDOM);
YAHOO.util.Event.onDOMReady(setSearchUserPref);
// ]]-->
</script>

<!-- ********************************** -->
<!-- START: ForeSee survey code in: /ssi/globalheader.ssi -->

<script type="text/javascript">
<!-- 
// Enable the survey for only English, German and Japanese
var agt=navigator.userAgent.toLowerCase();
if ( agt.indexOf("community help client") == -1 ){
    if ( document.location.href.indexOf("/en_US/") != -1 ){
        showSurvey();
//    }else if (document.location.href.indexOf("/de_DE/") != -1){
//         var locale="de";
//         showSurvey();
    }else if (document.location.href.indexOf("/ja_JP/") != -1 ){
         var locale="ja";
         showSurvey();
    }	
}

function showSurvey(){
	document.write('<script type="text/javascript" src="/js/foresee/foresee-trigger.js"><\/scr'+'ipt>');
}

// -->
</script>

<!-- END: ForeSee survey code -->
<!-- ******************************** -->




    <link rel="stylesheet" type="text/css" href="tree.css" />
    <link rel="stylesheet" type="text/css" href="content.css" />
    <link rel="stylesheet" type="text/css" href="localeSpecific.css" />
  </head>
  <body id="content_body" onload="window.focus();">
    <a name="top" shape="rect"><!--LeaveCommentHere--></a>
    
    <div id="mnemonic">
      <!--googleoff: index--><div xmlns:adobe="http://www.adobe.com/saxon" class="ColdFusion"><div class="banner"><a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html">Adobe&#160;ColdFusion&#160;9</a><span id="notyourversion">|&#160;
                    <a rel="nofollow" href="http://www.adobe.com/support/documentation/en/coldfusion/">Not your version?</a></span></div></div><!--googleon: index-->
    </div>
    
    <div id="searchbar">
<table id="searchbartable">
<tr>
<td colspan="2">
      <!--googleoff: index--><div xmlns:adobe="http://www.adobe.com/saxon"><div id="pdf"><img src="images/PDF.gif" width="16" height="16" /><a title="View Help PDF" href="coldfusion_9_dev.pdf">View Help PDF ( 23MB)</a></div></div><!--googleon: index-->
</td>
</tr>
</table>
    </div>

<!-- BEGIN SEARCH CONTENT -->
<form id="search" name="search" action="search.html" target="_self">
<script type="text/javascript">
<!--[CDATA[
if ( !use_chc_behavior ){
    if (typeof(terms_AHV_SEARCH_CONSTRAINT) != "undefined" && 
        terms_AHV_SEARCH_CONSTRAINT.length > 0 && 
        document.location.href.indexOf(".adobe.com") > 0){
        if ( typeof(terms_SEARCH_THIS_HELP_ONLY) != "undefined" && terms_SEARCH_THIS_HELP_ONLY == "ON" ) {
            document.write('<div id="searchscope"> \
                <input onchange="setAHSearchPref();" \
                class="gsa" \
                name="gsa" \
                id="gsa" \
                type="checkbox" \
                checked="checked" \
                value="1" ><\/input>'); 
                
        // Leave the "Search this help system only" checkbox unckecked
        }else{    
            document.write('<div id="searchscope"> \
                <input onchange="setAHSearchPref();" \
                class="gsa" \
                name="gsa" \
                id="gsa" \
                type="checkbox" \
                value="1" ><\/input>'); 
        }
        document.write('<span class="gsalabel">' + terms_AHV_SEARCH_CONSTRAINT + '<\/span><\/div>'); 
    }
    document.write('<input class="searchinput" \
        name="q" \
        id="q" \
        type="text" \
        maxlength="256" \
        value="' + terms_AHV_SEARCH_BUTTON + '" \
        onclick="clearSearch()"><\/input><input \
        type="button" \
        name="searchbutton" \
        class="searchbutton" \
        onclick="submit()"><\/input>'); 
} 
 
/* 
 * Start Functions 
 */
function clearSearch(){
    if (document.search.q.value == terms_AHV_SEARCH_BUTTON){document.search.q.value = ""}; 
}

// set search preferences
function setAHSearchPref(){
    if (document.search.gsa.checked == 1){
        setAHSearchCookie( dirname );
    }else{
        setAHSearchCookie( "community" );
    }
}

// Set search preferences cookie
function setAHSearchCookie( p ){
    // set cookie ah_searchpref with a value of the document path
    var expire=new Date();
    expire.setDate(expire.getDate()+365); // Cookie expires after 1 year (365 days) 
    document.cookie="ah_searchpref=" +p+ "; expires=" +expire.toGMTString()+ ";";
}

// ]]-->
</script> 
 </form>
<!-- END SEARCH CONTENT -->    



<!-- BEGIN PAGE CONTENT WRAPPER -->
    <div id="page_content_wrapper">
<!-- BEGIN PAGE WRAPPER -->
<table id="page_content_table">
<tr>

<td id="col2">
<!-- BEGIN CONTENT WRAPPER -->
<!-- BEGIN BREADCRUMBS -->

      
      <div id="breadcrumb">
        
<ul class="navigation"><li class="prev"><a accesskey="p" class="prev" href="WSf01dbd23413dda0e-5e5830f1200fd4080a-7ffd.html" title="The cfrethrow tag syntax"><img src="images/blank.gif" alt="Previous" width="17" height="17" /></a></li><li class="next"><a accesskey="n" class="next" href="WSc3ff6d0ea77859461172e0811cbec22c24-7fd4.html" title="Using Persistent Data and Locking"><img src="images/blank.gif" alt="Next" width="17" height="17" /></a></li></ul><div class="hierarchy" id="hierarchy"><a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Home</b></a> / <a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Developing&#160;ColdFusion 9 Applications</b></a> / <a href="WS8f0cc78011fffa71-ea0996f11cdae56045-8000.html"><b>Developing CFML Applications</b></a> 
      / <a href="WSc3ff6d0ea77859461172e0811cbec22c24-7fc4.html"><b>Handling Errors</b></a> 
      / <a href="WSc3ff6d0ea77859461172e0811cbec22c24-7e20.html"><b>Handling runtime exceptions with ColdFusion tags</b></a> 
     </div>

      </div>
<!-- END BREADCRUMBS -->
      <div id="content_wrapper">
<!-- BEGIN PAGE TITLE -->
        <h1>Example: using nested tags, cfthrow, and cfrethrow</h1>
<!-- END PAGE TITLE -->
<!-- BEGIN IONCOMMENTCOUNT -->
        <div id="ionCount">
        </div>
<!-- END IONCOMMENTCOUNT -->
<table id="inner_content_table" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td>
          <div style="border-top:#ccc solid 1px;"><p> </p>
          </div>
<p id="chcPromo" style="display:none;">
<a id="chcLink" href="http://www.adobe.com/support/chc/">
<img id="chcImage" src="http://www.adobe.com/support/chc/GetMoreHelpFeatures.png"/>
</a>
</p>
<script type="text/javascript" language="javascript" charset="utf-8">
<!--
var cfgArray = [];
//cfgArray["Acrobat_10.0_Professional.helpcfg"] = "acrobatpro";
//cfgArray["Acrobat_10.0_Standard.helpcfg"] = "acrobatstd";
cfgArray["Lightroom_3.0.helpcfg"] = "lightroom";
cfgArray["PhotoshopElements_8.0_Win.helpcfg"] = "photoshopelements";
cfgArray["PhotoshopElements_8.0_Mac.helpcfg"] = "photoshopelementsmac";
cfgArray["PremiereElements_8.0_Win.helpcfg"] = "premiereelements";

//cfgArray["AfterEffects_10.0.helpcfg"] = "aftereffects";
//cfgArray["AIR.helpcfg"] = "air";
//cfgArray["ColdFusionBuilder.helpcfg"] = "coldfusion";
//cfgArray["Contribute_6.0.helpcfg"] = "contribute";
//cfgArray["DeviceCentral_3.0.helpcfg"] = "devicecentral";
//cfgArray["Dreamweaver_11.0.helpcfg"] = "dreamweaver";
//cfgArray["EncoreDVD_5.0.helpcfg"] = "encore";
//cfgArray["ExtensionManager_3.0.helpcfg"] = "extension";
//cfgArray["Fireworks_11.0.helpcfg"] = "fireworks";
//cfgArray["Flash_11.0.helpcfg"] = "flash";
//cfgArray["Flex_4.0.helpcfg"] = "flashbuilder";
//cfgArray["FlashCatalyst_1.0.helpcfg"] = "flashcatalyst";
//cfgArray["Illustrator_15.0.helpcfg"] = "illustrator";
//cfgArray["InCopy_7.0.helpcfg"] = "incopy";
//cfgArray["InDesign_7.0.helpcfg"] = "indesign";
//cfgArray["OnLocation_5.0.helpcfg"] = "onlocation";
//cfgArray["Photoshop_12.0.helpcfg"] = "photoshop";
//cfgArray["PremierePro_5.0.helpcfg"] = "premierepro";

function getLangName() {
    var lang = "en-us";
    var metaElements = document.all ?
            document.all.tags('meta') :
            document.getElementsByTagName ?
            document.getElementsByTagName ('meta') : new Array();
    for (var m = 0; m < metaElements.length; m++) {
        if (metaElements[m].name == "lang") {
            lang = metaElements[m].content;
            break;
        }
    }
    var ptn = /(..)-(..)/;
    if (ptn.test(lang)) {
        var languageCode = lang.replace(ptn, "$1");
        var countryCode = lang.replace(ptn, "$2");
        lang = languageCode + "_" + countryCode.toUpperCase();
    }
    return lang;
}

function getCountryName() {
    var lang = "";
    var metaElements = document.all ?
            document.all.tags('meta') :
            document.getElementsByTagName ?
            document.getElementsByTagName ('meta') : new Array();
    for (var m = 0; m < metaElements.length; m++) {
        if (metaElements[m].name == "lang") {
            lang = metaElements[m].content;
            break;
        }
    }
    var ptn = /(..)-(..)/;
    if ((ptn.test(lang)) && (lang != "en-us")) {
        var countryCode = lang.replace(ptn, "$2");
        return "/" + countryCode;
    }
    return "";
}

if ( (typeof(terms_HELPCFG) != 'undefined')  && (terms_HELPCFG.indexOf(".helpcfg") != -1) ) {
    var stage   = (document.location.href.indexOf(".stage.") != -1) ? 'stage.' : '';
    var baseUrl = 'http://www.' + stage + 'adobe.com';
    var refpage = document.location.href.replace(/#.*$/, '');
	
	if ((!use_robohelp_behavior) && (terms_HELPCFG.length > 0) && (typeof(cfgArray[terms_HELPCFG]) != 'undefined') && (cfgArray[terms_HELPCFG].length > 0)) {
		if (document.getElementById) { // DOM3 = IE5, NS6
			var newHref = baseUrl + getCountryName() + "/support/chc/" + "?helpcfg=http://help." + stage + "adobe.com/HelpCfg/" + getLangName() + "/" + terms_HELPCFG + "&url=" + refpage + "&product=" + cfgArray[terms_HELPCFG];
			var newSrc = baseUrl + getCountryName() + "/support/chc/GetMoreHelpFeatures.png";
			document.getElementById("chcPromo").style.display = "block";
			document.getElementById("chcLink").href = newHref;
			document.getElementById("chcImage").src = newSrc;
		}
	}
}

//-->
</script>



          <div><p>The
following example shows many of the discussed techniques including nested <samp class="codeph"><a href="http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-7ec6.html" target="_self">cftry</a></samp> blocks and the <samp class="codeph"><a href="http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-7e25.html" target="_self">cfthrow</a></samp> and <samp class="codeph"><a href="http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-7e24.html" target="_self">cfrethrow</a></samp> tags. The example includes
a simple calling page and a custom tag page: </p>
<ul><li><p>The calling page does little more than call the custom
tag with a single attribute, a name to be looked up in a database.
It does show, however, how a calling page can handle an exception
thrown by the custom tag.</p>
</li>
<li><p>The custom tag finds all records in the cfdocexamples database
with a matching last name, and returns the results in a Caller variable.
If it fails to connect with the main database, it tries a backup
database. </p>
</li>
</ul>
<div class="section" id="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fce"><a name="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fce"><!-- --></a><h4 class="sectiontitle">The calling page</h4><p>The calling page represents a section from
a larger application page. To keep things simple, the example hard-codes
the name to be looked up.</p>
<pre>&lt;cftry&gt; 
    &lt;cf_getEmps EmpName="Jones"&gt; 
    &lt;cfcatch type="myApp.getUser.noEmpName"&gt; 
        &lt;h2&gt;Oops&lt;/h2&gt; 
        &lt;cfoutput&gt;#cfcatch.Message#&lt;/cfoutput&gt;&lt;br&gt; 
    &lt;/cfcatch&gt; 
&lt;/cftry&gt; 
&lt;cfif isdefined("getEmpsResult")&gt; 
    &lt;cfdump var="#getEmpsResult#"&gt; 
&lt;/cfif&gt;</pre>
</div>
<div class="section" id="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fca"><a name="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fca"><!-- --></a><h4 class="sectiontitle">Reviewing the code</h4><p>The following table describes the code:</p>

<div class="tablenoborder"><table border="1" cellpadding="4" cellspacing="0"><thead align="left"><tr><th valign="top" width="NaN%" id="d17e30927"><p>Code</p>
</th>
<th valign="top" width="NaN%" id="d17e30930"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td valign="top" width="NaN%" headers="d17e30927 "><div class="para"><pre>&lt;cftry&gt; 
    &lt;cf_getEmps EmpName="Jones"&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30930 "><p>In a <samp class="codeph">cftry</samp> block, calls
the cf_getEmps custom tag (getEmps.cfm).</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30927 "><div class="para"><pre>&lt;cfcatch type="myApp.getUser.noEmpName"&gt; 
    &lt;h2&gt;Oops&lt;/h2&gt; 
    &lt;cfoutput&gt;#cfcatch.Message#&lt;/cfoutput&gt;&lt;br&gt; 
&lt;/cfcatch&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30930 "><p>If the tag throws an exception indicating
that it did not receive a valid attribute, catches the exception
and displays a message, including the message variable set by the <samp class="codeph">cfthrow</samp> tag
in the custom tag.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30927 "><div class="para"><pre>&lt;cfif isdefined("getEmpsResult")&gt; 
    &lt;cfdump var="#getEmpsResult#"&gt; 
&lt;/cfif&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30930 "><p>If the tag returns a result, uses the <samp class="codeph">cfdump</samp> tag
to display it. (A production application would not use the <samp class="codeph">cfdump</samp> tag.)</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcb"><a name="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcb"><!-- --></a><h4 class="sectiontitle">The custom tag page</h4><p>The custom tag page searches for the name
in the database and returns any matching records in a getEmpsResult
variable in the calling page. It includes several nested <samp class="codeph">cftry</samp> blocks
to handle error conditions. For a full description, see <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">Reviewing the code</i> section,
following the example:</p>
<p>Save the following code as getEmps.cfm
in the same directory as the calling page.</p>
<pre>&lt;!--- If the tag didn't pass an attribute, throw an error to be handled by 
            the calling page ---&gt; 
&lt;cfif NOT IsDefined("attributes.EmpName")&gt; 
    &lt;cfthrow Type="myApp.getUser.noEmpName" 
        message = "Last Name was not supplied to the cf_getEmps tag."&gt; 
    &lt;cfexit method = "exittag"&gt; 
&lt;!--- Have a name to look up ---&gt; 
&lt;cfelse&gt; 
&lt;!--- Outermost Try Block ---&gt; 
    &lt;cftry&gt; 
 
&lt;!--- Inner Try Block ---&gt; 
        &lt;cftry&gt; 
&lt;!--- Try to query the main database and set a caller variable to the result ---&gt; 
            &lt;cfquery Name = "getUser" DataSource="cfdocexamples"&gt; 
                SELECT *  
                FROM Employee 
                WHERE LastName = '#attributes.EmpName#' 
            &lt;/cfquery&gt; 
            &lt;cfset caller.getEmpsResult = getuser&gt; 
&lt;!--- If the query failed with a database error, check the error type 
            to see if the database was found ---&gt;             
            &lt;cfcatch type= "Database"&gt; 
                &lt;cfif (cfcatch.SQLState IS "S100") OR (cfcatch.SQLState IS 
                    "IM002")&gt; 
 
&lt;!--- If the database wasn't found, try the backup database ---&gt; 
&lt;!--- Use a third-level Try block ---&gt; 
                    &lt;cftry&gt; 
                        &lt;cfquery Name = "getUser" DataSource="cfdocexamplesBackup"&gt; 
                            SELECT *  
                            FROM Employee 
                            WHERE LastName = '#attributes.EmpName#' 
                        &lt;/cfquery&gt; 
                            &lt;cfset caller.getEmpsResult = getuser&gt; 
 
&lt;!--- If still get a database error, just return to the calling page 
            without setting the caller variable. There is no cfcatch body. 
            This might not be appropriate in some cases.  
            The Calling page ends up handling this case as if a match was not 
            found ---&gt; 
                            &lt;cfcatch type = "Database" /&gt; 
&lt;!--- Still in innermost try block. Rethrow any other errors to the next 
            try block level ---&gt;                         
                        &lt;cfcatch type = "Any"&gt; 
                            &lt;cfrethrow&gt; 
                        &lt;/cfcatch&gt; 
                    &lt;/cftry&gt; 
 
&lt;!--- Now in second level try block. 
            Throw all other types of Database exceptions to the next try  
                block level ---&gt; 
                &lt;cfelse&gt; 
                    &lt;cfrethrow&gt; 
                &lt;/cfif&gt; 
            &lt;/cfcatch&gt; 
&lt;!--- Throw all other exceptions to the next try block level ---&gt; 
            &lt;cfcatch type = "Any"&gt; 
                    &lt;cfrethrow&gt; 
            &lt;/cfcatch&gt; 
        &lt;/cftry&gt; 
 
&lt;!--- Now in Outermost try block.  
         Handle all unhandled exceptions, including rethrown exceptions, by 
            displaying a message and exiting to the calling page.---&gt; 
        &lt;cfcatch Type = "Any"&gt; 
            &lt;h2&gt;Sorry&lt;/h2&gt; 
            &lt;p&gt;An unexpected error happened in processing your user inquiry. 
                Please report the following to technical support:&lt;/p&gt; 
            &lt;cfoutput&gt; 
                Type: #cfcatch.Type# 
                Message: #cfcatch.Message# 
            &lt;/cfoutput&gt; 
            &lt;cfexit method = "exittag"&gt; 
        &lt;/cfcatch&gt; 
    &lt;/cftry&gt;     
&lt;/cfif&gt;</pre>
</div>
<div class="section" id="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec22c24-7ccf"><a name="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec22c24-7ccf"><!-- --></a><h4 class="sectiontitle">Reviewing the code</h4><p>The following table describes the code:</p>

<div class="tablenoborder"><table border="1" cellpadding="4" cellspacing="0"><thead align="left"><tr><th valign="top" width="NaN%" id="d17e30996"><p>Code</p>
</th>
<th valign="top" width="NaN%" id="d17e30999"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfif NOT IsDefined("attributes.EmpName")&gt; 
&lt;cfthrow Type="myApp.getUser.noEmpName" 
    message = "Last Name was not supplied to the cf_getEmps tag."&gt; 
&lt;cfexit method = "exittag"&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>Makes sure the calling page specified an <samp class="codeph">EmpName</samp> attribute.
If not, throws a custom error that indicates the problem and exits the
tag. The calling page handles the thrown error.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfelse&gt; 
&lt;cftry&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>If the tag has an <samp class="codeph">EmpName</samp> attribute,
does the remaining work inside an outermost try block. The <samp class="codeph">cfcatch</samp> block
at its end handles any otherwise-uncaught exceptions.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cftry&gt; 
&lt;!--- Try to query the main database and set a caller variable to the result ---&gt; 
    &lt;cfquery Name = "getUser" DataSource="cfdocexamples"&gt; 
        SELECT *  
        FROM Employee 
        WHERE LastName = '#attributes.EmpName#' 
    &lt;/cfquery&gt; 
    &lt;cfset caller.getEmpsResult = getuser&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>Starts a second nested try block. This block
catches exceptions in the database query. </p>
<p>If there are no
exceptions, sets the calling page’s <samp class="codeph">getEmpsResult</samp> variable
with the query results.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfcatch type= "Database"&gt; 
    &lt;cfif (cfcatch.SQLState IS "S100") OR (cfcatch.SQLState IS "IM002")&gt; 
     &lt;cftry&gt; 
        &lt;cfquery Name = "getUser" DataSource="cfdocexamplesBackup"&gt; 
        SELECT *  
        FROM Employee 
        WHERE LastName = '#attributes.EmpName#' 
        &lt;/cfquery&gt; 
        &lt;cfset caller.getEmpsResult = getuser&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>If the query threw a Database error, checks
to see if the error was caused by an inability to access the database
(indicated by an <samp class="codeph">SQLState</samp> variable value of S100
or IM002). </p>
<p>If the database was not found, starts a third
nested try block and tries accessing the backup database. This try
block catches exceptions in this second database access.</p>
<p>If
the database inquiry succeeds, sets the calling page’s <samp class="codeph">getEmpsResult</samp> variable
with the query results.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfcatch type = "Database" /&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>If the second database query failed with
a database error, gives up silently. Because the Database type <samp class="codeph">cfcatch</samp> tag
does not have a body, the tag exits. The calling page does not get
a <samp class="codeph">getEmpsResult</samp> variable. It cannot tell whether
the database had no match or an unrecoverable database error occurred,
but it does know that no match was found.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfcatch type = "Any"&gt; 
    &lt;cfrethrow&gt; 
&lt;/cfcatch&gt; 
&lt;/cftry&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>If the second database query failed for
any other reason, throws the error up to the next try block.</p>
<p>Ends
the innermost try block</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfelse&gt; 
    &lt;cfrethrow&gt; 
    &lt;/cfif&gt; 
&lt;/cfcatch&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>In the second try block, handles the case
in which the first database query failed for a reason other than
a failure to find the database. </p>
<p>Rethrows the error up to
the next level, the outermost try block. </p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfcatch type = "Any"&gt; 
    &lt;cfrethrow&gt; 
&lt;/cfcatch&gt; 
&lt;/cftry&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>In the second try block, catches any errors
other exceptions and rethrows them up to the outermost try block. </p>
<p>Ends
the second try block.</p>
</td>
</tr>
<tr><td valign="top" width="NaN%" headers="d17e30996 "><div class="para"><pre>&lt;cfcatch Type = "Any"&gt; 
    &lt;h2&gt;Sorry&lt;/h2&gt; 
    &lt;p&gt;An unexpected error happened in processing your user inquiry. Please report the following to technical support:&lt;/p&gt; 
    &lt;cfoutput&gt; 
    Type: #cfcatch.Type# 
    Message: #cfcatch.Message# 
    &lt;/cfoutput&gt; 
    &lt;cfexit method = "exittag"&gt; 
&lt;/cfcatch&gt; 
&lt;/cftry&gt;     
&lt;/cfif&gt;</pre>
</div>
</td>
<td valign="top" width="NaN%" headers="d17e30999 "><p>In the outermost try block, handles any
exceptions by displaying an error message that includes the exception
type and the exception’s error message. Because there was no code
to try that is not also in a nested try block, this <samp class="codeph">cfcatch</samp> tag
handles only errors that are rethrown from the nested blocks.</p>
<p>Exits
the custom tag and returns to the calling page.</p>
<p>Ends the catch
block, try block, and initial <samp class="codeph">cfif</samp> block.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcd"><a name="WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcf__WSc3ff6d0ea77859461172e0811cbec0bb9b-7fcd"><!-- --></a><h4 class="sectiontitle">Testing the code</h4><p>To test the various ways errors can occur and
be handled in this example, try the following:</p>
<ul><li><p>In
the calling page, change the attribute name to any other value;
for example, My Attrib. Then change it back.</p>
</li>
<li><p>In the first <samp class="codeph"><a href="http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-7fae.html" target="_self">cfquery</a></samp> tag, change the data
source name to an invalid data source; for example, NoDatabase.</p>
</li>
<li><p>With an invalid first data source name, change the data source
in the second <samp class="codeph">cfquery</samp> tag to cfdocexamples.</p>
</li>
<li><p>Insert <samp class="codeph"><a href="http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-7e25.html" target="_self">cfthrow</a></samp> tags throwing custom
exculpations in various places in the code and observe the effects.</p>
</li>
</ul>
</div>
</div>


<!-- BEGIN USER PREFERENCES -->
          <div id="userprefs">
          </div>
<!-- END USER PREFERENCES -->

          <div id="related">
            
            
            <div class="separator">&#160;</div>
          </div>
          <div id="footer">
<!-- BEGIN IONCOMMENTS -->
            <div id="ionComHere">
            </div>
<!-- END IONCOMMENTS -->


            <p id="creativecommons"><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" id="creativecommons_text"><img id="creativecommons_img" src="images/CC.png" alt="This work is licensed under a Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License" /></a>&nbsp;Twitter™ and Facebook posts are not covered under the terms of Creative Commons.</p>
          </div>
</td>
<td width="10px"></td>
<td id="inner_rightcolumn">

</td></tr></table>
      </div>
<!-- BEGIN BREADCRUMBS -->
      <div id="breadcrumb">
        
<ul class="navigation"><li class="prev"><a accesskey="p" class="prev" href="WSf01dbd23413dda0e-5e5830f1200fd4080a-7ffd.html" title="The cfrethrow tag syntax"><img src="images/blank.gif" alt="Previous" width="17" height="17" /></a></li><li class="next"><a accesskey="n" class="next" href="WSc3ff6d0ea77859461172e0811cbec22c24-7fd4.html" title="Using Persistent Data and Locking"><img src="images/blank.gif" alt="Next" width="17" height="17" /></a></li></ul><div class="hierarchy" id="hierarchy"><a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Home</b></a> / <a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Developing&#160;ColdFusion 9 Applications</b></a> / <a href="WS8f0cc78011fffa71-ea0996f11cdae56045-8000.html"><b>Developing CFML Applications</b></a> 
      / <a href="WSc3ff6d0ea77859461172e0811cbec22c24-7fc4.html"><b>Handling Errors</b></a> 
      / <a href="WSc3ff6d0ea77859461172e0811cbec22c24-7e20.html"><b>Handling runtime exceptions with ColdFusion tags</b></a> 
     </div>

      </div>
<!-- END BREADCRUMBS -->
<!-- END CONTENT WRAPPER -->

</td>
<td id="col3">
    <div>
        <img src="images/adobe-lq.png" />
    </div>
</td>
</tr>
</table>
    </div>
<!-- END PAGE CONTENT WRAPPER -->
<script type="text/javascript">
<!--[CDATA[
scrollToNameAnchor();
// ]]-->
</script> 
<!--
    Description:
    This file generates the link to product support in the top right corner
-->

<style>
#menutop{
    position:absolute;
    top:4px;
    right:24px;
    width:auto;    
    font-size:11px;
    color:#fff;
    text-align:right;
}
#menutop a{
    color:#fff;
}
#menutop a:hover{
        text-decoration:underline;
}
</style>  
  
  
  
  
<div id="productmenu">
<!--googleoff: index-->
  <div id="menutop">


<script language=javascript type='text/javascript'>
    // darken menu text for products with light backgrounds
    var path = document.location.href.toLowerCase();
    if (path.indexOf("/acrobat/")           	> 0 ||
        path.indexOf("/acrobat.com/")       	> 0 ||
        path.indexOf("/acrobatConnectPro/") 	> 0 ||
        path.indexOf("/connect/")           	> 0 ||
        path.indexOf("/livecycledataserviceses/") > 0 ||
        path.indexOf("/muse/")         	> 0 ||
	path.indexOf("/presenter/")         	> 0 ||
        path.indexOf("/scene7/")            	> 0 ||
        path.indexOf("/flashmediaserver/")  	> 0 ||
        path.indexOf("/wave/")              	> 0 )
    {
        document.write('<style>#menutop a{color:#505050}</style>');
    }
    if (typeof('terms_AHV_PRODUCT_SUPPORT') != "undefined" && ! use_robohelp_behavior ){      
        if (path.indexOf("/muse/") > -1 ){
            var supportlink = '<a href="http://muse.adobe.com/support.html">'+terms_AHV_PRODUCT_SUPPORT+'</a>';
        }else{
            var supportlink = '<a href="http://adobe.com/support">'+terms_AHV_PRODUCT_SUPPORT+'</a>';
        }
        document.write( supportlink );
     }

</script> 

  </div>
<!--googleon: index-->
</div>



<style>
#online-privacy-policy{ 
    margin:10px 40px; 
    font-size:11px;
}
</style>

<p id="online-privacy-policy">
<script language="javascript">
var pageLoc = "en_US";
var metaElements = document.all ?
document.all.tags('meta') :
document.getElementsByTagName ?
document.getElementsByTagName ('meta') : new Array();
for (var m = 0; m < metaElements.length; m++) {
	if (metaElements[m].name == "lang") {
		pageLoc = metaElements[m].content;
		break;
	}
}
var ptn = /(..)-(..)/;
if (ptn.test(pageLoc)) {
	var languageCode = pageLoc.replace(ptn, "$1");
	var countryCode = pageLoc.replace(ptn, "$2");
	pageLoc = languageCode + "_" + countryCode.toUpperCase();
}

var policyLoc = "en_US";
var policyText = "Online Privacy Policy";
var policyPath = "";
var policyArray=[
"da_DK", "Online fortrolighedserklæring",
"de_DE", "Online-Datenschutzrichtlinie",
"es_ES", "Política de confidencialidad en línea",
"fi_FI", "Yksityisyyttä koskeva Online-toimintaohjelma",
"fr_FR", "Confidentialité et sécurité",
"it_IT", "Informativa sulla privacy online",
"ja_JP", "プライバシーポリシー",
"ko_KR", "Adobe 온라인 개인정보 보호정책",
"pt_BR", "Política de Confidencialidade On-line", 
"zh_CN", "在线隐私政策",
"zh_TW", "線上隱私政策"
];
var legalLoc = "en_US";
var legalText = "Legal Notices";
var legalPath = legalLoc;
var legalArray=[
"ar_AE", "إشعارات قانونية",
"bg_BG", "Юридически бележки",
"cs_CZ", "Právní upozornění",
"da_DK", "Juridiske meddelelser",
"de_DE", "Rechtliche Hinweise",
"el_GR", "Σημειώσεις νομικού περιεχομένου",
"es_ES", "Avisos legales",
"et_EE", "Juriidilised teated",
"fi_FI", "Lakisääteiset ilmoitukset",
"fr_FR", "Mentions légales",
"he_IL", "הצהרות משפטיות",
"hr_HR", "Pravne napomene",
"hu_HU", "Jogi közlemények",
"it_IT", "Informazioni legali",
"ja_JP", "法律上の注意",
"ko_KR", "법적 고지 사항",
"lt_LT", "Teisinės pastabos",
"lv_LV", "Juridisks paziņojums",
"nb_NO", "Juridiske merknader",
"nl_NL", "Juridische kennisgevingen",
"pl_PL", "Informacje prawne",
"pt_BR", "Aspectos jurídicos",
"ro_RO", "Prevederi legale",
"ru_RU", "Юридическая информация",
"sk_SK", "Právne upozornenie",
"sl_SI", "Pravni pouk",
"sv_SE", "Upphovsrätt",
"tr_TR", "Yasal uyarılar",
"uk_UA", "Юридична інформація",
"zh_CN", "法律声明",
"zh_TW", "法律注意事項"
];

ruPolicy = "http://www.adobe.com/ru/misc/privacy.html";
trPolicy = "http://www.adobe.com/tr/misc/privacy.html";

// Bug 2846992: LOC: RUS, TUR: The link to "Online Privacy Policy" should include language, currently it is not appearing.
if (pageLoc == "ru_RU") {
	policyPath = "ru";
}
else if (pageLoc == "tr_TR") {
	policyPath = "tr";
}
for (var i = 0; i < policyArray.length; i+=2) {
	if (pageLoc == policyArray[i]) {
		policyLoc = pageLoc;
		policyText = policyArray[i+1];
		var ptn = /(..)_(..)/;
		if (ptn.test(policyLoc)) {
			var countryCode = policyLoc.replace(ptn, "$2");
			policyPath = countryCode.toLowerCase();
		}
		break;
	}
}

for (var i = 0; i < legalArray.length; i+=2) {
	if (pageLoc == legalArray[i]) {
		legalLoc = pageLoc;
		legalText = legalArray[i+1];
		legalPath = legalLoc;
		break;
	}
}
if(agt.indexOf("community help client") > -1 ){
	document.write('<a href="/'+legalPath+'/legalnotices/index.html">'+legalText+'<\/a>');
	document.write(' | ');
	document.write('<a href="http://www.adobe.com/'+policyPath+'/misc/privacy.html">'+policyText+'<\/a>');
}else{
	//Open the privacy policy in a new window
	document.write('<a target="_blank" href="/'+legalPath+'/legalnotices/index.html">'+legalText+'<\/a>');
	document.write(' | ');
	document.write('<a target="_blank" href="http://www.adobe.com/'+policyPath+'/misc/privacy.html">'+policyText+'<\/a>');
} 
</script>
</p>



<!-- localfooter.ssi -->

<script type="text/javascript">
    var debug = (top.location.href.indexOf("debug=true") > -1);
</script>

<script language="javascript">
document.write('<scr'+'ipt ' +
               'src="/en_US/ssi/_pod.js" ' +
               'language="javascript" ' +
               'charset="UTF-8"> ' +
               '</scr'+'ipt>');
</script>


<script type="text/javascript">
//
//  Ethnio survey code
//
/*          DocumentID      EthnioID */
/*          -------------   -------- */
var ethnio=["/en_US/flash/cs/using/WSb03e830bd6f770ee6664507612436d7dede-8000.html", "87462",
            "/en_US/creativesuite/cs/using/WSe851854fd1e0856a-4b08a77612477f69f15-8000.html",  "10441",
            "/en_US/dreamweaver/cs/using/WSEE4C0148-A6F4-4bf5-9DEF-CE06AB026214a.html",  "57412"
 
    ];
                        
    for ( var i = 0; i < ethnio.length ; i = i+2 ){
        if ( document.location.href.indexOf( ethnio[i] ) > -1 ){ 
            var headID = document.getElementsByTagName("head")[0];         
            var ethnioScript = document.createElement('script');
            ethnioScript.type = 'text/javascript';
            ethnioScript.src = 'http://ethn.io/remotes/' + ethnio[i+1];        
            if ( debug ){
                alert ("Using Ethnio script: " + ethnioScript.src );
            }else{
                headID.appendChild(ethnioScript);
            }
        }
    }
</script>



<div style="display: none;">
<!-- SiteCatalyst -->
<script language="JavaScript" type="text/javascript"><!--
var s_code=' ';
var s_docHost = window.location.hostname.toLowerCase();
var s_docURL = window.location.pathname.toLowerCase();
var scJsHost = (("https:" == document.location.protocol) ? "https://www.adobe.com" : "http://wwwimages.adobe.com");
if (s_docHost.indexOf(".corp.adobe") != -1 || s_docHost.indexOf("stage.") != -1 || s_docHost.indexOf(".dev.adobe") != -1 || s_docHost.indexOf("staging.") != -1) scJsHost="";
document.write(unescape("%3Cscript src='" + scJsHost + "/uber/js/omniture_s_code.js' type='text/javascript'%3E%3C/script%3E"));
//--></script>
<script type="text/javascript"><!--
var s_accountName;
s_server="www.adobe.com static content pages";
if (!window.s_account) s_accountName="mxmacromedia";
else s_accountName=window.s_account;

if (window.s_docURL.indexOf("/designcenter/") != -1)
  s_channel="Adobe Design Center";	
else if ((window.s_docHost.indexOf("labs.adobe") != -1) ||
(window.s_docHost.indexOf("labs-staging.") != -1))
  s_channel="Labs";
else if (window.s_docHost.indexOf("help.adobe.com") != -1) {
  s_channel="Support Help.adobe.com";
  if (window.s_docURL.indexOf("/en_us/") == -1) {
    s_docURLArray=s_docURL.split('/');
    s_pageName="http://help.adobe.com/"+s_docURLArray[1]+"/"+ s_docURLArray[2]+"/"+s_docURLArray[3];
    s_prop23="http://help.adobe.com"+window.location.pathname;
  }
}
else if (window.s_docHost.indexOf("kb2.adobe.com") != -1) {
  s_channel="Support Knowledgebase";
  s_prop23="http://kb2.adobe.com"+s_docURL+":";
  if (typeof(omtrProductList) != 'undefined' && omtrProductList.length > 0)
 {
    s_prop23=s_prop23+omtrProductList;
  }
}
else if (window.s_docHost.indexOf("resellers.adobe.com") != -1) {
		var s_pageName=document.getElementsByTagName("title")[0].text;
}

if (!window.scMMInclude) {
	var s_wd=window,s_tm=new Date;
	if(s_code!=' '){
		s_code=s_dc(s_accountName);
		if(s_code)document.write(s_code)
	} 
} else {
	s_wds(s_accountName);s_ca(s_accountName); 
}	

function sendAnalyticsEvent(str){var ns=s_accountName;if(str!=null)ns+=","+str;void(s_gs(ns));}
function sendLinkEvent(accnt,lnkname,type){
accnt=s_accountName;s_linkType=type;s_lnk=true;s_linkName=lnkname;void(s_gs(accnt));}
//--></script>
<noscript><img src="http://stats.adobe.com/b/ss/mxmacromedia/1/H.15-XELvs/0?pageName=http%3A//www.adobe.com%3A%20noscript&ch=http%3A//www.adobe.com%3A%20noscript&g=http%3A//www.adobe.com" height="1" width="1" border="0" alt="" /></noscript>
<!-- End SiteCatalyst -->
</div>

<script language="JavaScript" type="text/javascript">//<![CDATA[
var scJsHost = (("https:" == document.location.protocol) ? "https://www.adobe.com" : "http://wwwimages.adobe.com");
document.write(unescape("%3Cscript src='" + scJsHost + "/uber/js/atm/s_code_www.js' type='text/javascript'%3E%3C/script%3E"));
//]]></script>
<script type="text/javascript">//<![CDATA[
if(s_adobe){	
	s_adobe.server="www.adobe.com Static Content pages";
	/* Set pageName */
	s_adobe.s_URL="adobe.com"+((location.pathname.charAt(0)=='/')?location.pathname:'/'+location.pathname);
	if (s_adobe.s_URL.substring(s_adobe.s_URL.lastIndexOf('/')+1)=="") s_adobe.s_URL=s_adobe.s_URL+"index.html";
	s_adobe.s_URLSplit=s_adobe.s_URL.split("/");
	s_adobe.pageName=s_adobe.s_URLSplit.join(":");

	/* Set prop4 to language-locale */
	var s_meta=document.getElementsByTagName('meta'); 
      for (i=0; i<s_meta.length; i++) { 
        if (s_meta[i].getAttribute("http-equiv") == "Content-Language") { 
          s_adobe.prop4=s_meta[i].getAttribute("content"); 
	    s_adobe.prop4=s_adobe.prop4.replace(/\s+/g,'');
        } 
      } 
	s_adobe.t()
}
//]]></script>








  </body>
</html>