<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0022)http://help.adobe.com/ -->
<html lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="lang" content="en-us" />
    <meta name="area" content="livedocs" />
    <title>Adobe&#160;ColdFusion&#160;9 * Building an event gateway</title>
    <link rel="shortcut icon" href="images/ColdFusionLinkIndicator.png" />
    <meta name="book" content="Developing&#160;ColdFusion 9 Applications" />
    <meta name="product" content="ColdFusion" />
    <meta name="keywords" content="" /><!--<PageMap><DataObject type="document"><Attribute name="product" value="ColdFusion"></Attribute><Attribute name="book" value="Developing&#160;ColdFusion 9 Applications"></Attribute><Attribute name="keywords" value=""></Attribute></DataObject></PageMap>-->
    
    <script type="text/javascript" language="Javascript" charset="UTF-8"><!--[CDATA[
        var currentTreeNode = "WSc3ff6d0ea77859461172e0811cbec22c24-779d.html";
    document.cookie = "topicId=" + "WSc3ff6d0ea77859461172e0811cbec22c24-779d.html";
// ]]--></script>
<script src="terms.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="help.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script>  <script src="utilities.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="event.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="treeview.js" type="text/javascript" language="Javascript" charset="UTF-8">...</script> <script src="toc.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script> <script src="swfobject.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script>  <script src="booklist.js" language="Javascript" type="text/javascript" charset="UTF-8">..</script>
<script type="text/javascript">
<!--[CDATA[
var topictype = "topic";
var headId = document.getElementsByTagName("head")[0];         
if (use_ie_6_behavior) {
  var linkId = document.createElement("link");
  linkId.href = "content-ie6.css";
  linkId.rel = "stylesheet";
  linkId.type = "text/css";
  headId.appendChild(linkId);
}
function initRoboHelpDOM() {
  if (use_chm_behavior) {
    hideElement("search");
  }
  if (use_robohelp_behavior) {
    hideElement("search");
    hideElement("productmenu");
    //hideElement("notyourversion");
  }
  if(!use_chc_behavior) {
    //document.getElementById("notyourversion").style.display = "inline";;
  }
}
var dirname = location.pathname.match( /.*\// );    
function setSearchUserPref(){
  if ( document.cookie.indexOf( "ah_searchpref" ) > -1 ) {
    if ( document.cookie.indexOf( dirname ) > 0 ) {
      document.search.gsa.checked = true ;
    }else{
      document.search.gsa.checked = false ;            
    }
  }
}
YAHOO.util.Event.onDOMReady(initRoboHelpDOM);
YAHOO.util.Event.onDOMReady(setSearchUserPref);
// ]]-->
</script>

<!-- ********************************** -->
<!-- START: ForeSee survey code in: /ssi/globalheader.ssi -->

<script type="text/javascript">
<!-- 
// Enable the survey for only English, German and Japanese
var agt=navigator.userAgent.toLowerCase();
if ( agt.indexOf("community help client") == -1 ){
    if ( document.location.href.indexOf("/en_US/") != -1 ){
        showSurvey();
//    }else if (document.location.href.indexOf("/de_DE/") != -1){
//         var locale="de";
//         showSurvey();
    }else if (document.location.href.indexOf("/ja_JP/") != -1 ){
         var locale="ja";
         showSurvey();
    }	
}

function showSurvey(){
	document.write('<script type="text/javascript" src="/js/foresee/foresee-trigger.js"><\/scr'+'ipt>');
}

// -->
</script>

<!-- END: ForeSee survey code -->
<!-- ******************************** -->




    <link rel="stylesheet" type="text/css" href="tree.css" />
    <link rel="stylesheet" type="text/css" href="content.css" />
    <link rel="stylesheet" type="text/css" href="localeSpecific.css" />
  </head>
  <body id="content_body" onload="window.focus();">
    <a name="top" shape="rect"><!--LeaveCommentHere--></a>
    
    <div id="mnemonic">
      <!--googleoff: index--><div xmlns:adobe="http://www.adobe.com/saxon" class="ColdFusion"><div class="banner"><a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html">Adobe&#160;ColdFusion&#160;9</a><span id="notyourversion">|&#160;
                    <a rel="nofollow" href="http://www.adobe.com/support/documentation/en/coldfusion/">Not your version?</a></span></div></div><!--googleon: index-->
    </div>
    
    <div id="searchbar">
<table id="searchbartable">
<tr>
<td colspan="2">
      <!--googleoff: index--><div xmlns:adobe="http://www.adobe.com/saxon"><div id="pdf"><img src="images/PDF.gif" width="16" height="16" /><a title="View Help PDF" href="coldfusion_9_dev.pdf">View Help PDF ( 23MB)</a></div></div><!--googleon: index-->
</td>
</tr>
</table>
    </div>

<!-- BEGIN SEARCH CONTENT -->
<form id="search" name="search" action="search.html" target="_self">
<script type="text/javascript">
<!--[CDATA[
if ( !use_chc_behavior ){
    if (typeof(terms_AHV_SEARCH_CONSTRAINT) != "undefined" && 
        terms_AHV_SEARCH_CONSTRAINT.length > 0 && 
        document.location.href.indexOf(".adobe.com") > 0){
        if ( typeof(terms_SEARCH_THIS_HELP_ONLY) != "undefined" && terms_SEARCH_THIS_HELP_ONLY == "ON" ) {
            document.write('<div id="searchscope"> \
                <input onchange="setAHSearchPref();" \
                class="gsa" \
                name="gsa" \
                id="gsa" \
                type="checkbox" \
                checked="checked" \
                value="1" ><\/input>'); 
                
        // Leave the "Search this help system only" checkbox unckecked
        }else{    
            document.write('<div id="searchscope"> \
                <input onchange="setAHSearchPref();" \
                class="gsa" \
                name="gsa" \
                id="gsa" \
                type="checkbox" \
                value="1" ><\/input>'); 
        }
        document.write('<span class="gsalabel">' + terms_AHV_SEARCH_CONSTRAINT + '<\/span><\/div>'); 
    }
    document.write('<input class="searchinput" \
        name="q" \
        id="q" \
        type="text" \
        maxlength="256" \
        value="' + terms_AHV_SEARCH_BUTTON + '" \
        onclick="clearSearch()"><\/input><input \
        type="button" \
        name="searchbutton" \
        class="searchbutton" \
        onclick="submit()"><\/input>'); 
} 
 
/* 
 * Start Functions 
 */
function clearSearch(){
    if (document.search.q.value == terms_AHV_SEARCH_BUTTON){document.search.q.value = ""}; 
}

// set search preferences
function setAHSearchPref(){
    if (document.search.gsa.checked == 1){
        setAHSearchCookie( dirname );
    }else{
        setAHSearchCookie( "community" );
    }
}

// Set search preferences cookie
function setAHSearchCookie( p ){
    // set cookie ah_searchpref with a value of the document path
    var expire=new Date();
    expire.setDate(expire.getDate()+365); // Cookie expires after 1 year (365 days) 
    document.cookie="ah_searchpref=" +p+ "; expires=" +expire.toGMTString()+ ";";
}

// ]]-->
</script> 
 </form>
<!-- END SEARCH CONTENT -->    



<!-- BEGIN PAGE CONTENT WRAPPER -->
    <div id="page_content_wrapper">
<!-- BEGIN PAGE WRAPPER -->
<table id="page_content_table">
<tr>

<td id="col2">
<!-- BEGIN CONTENT WRAPPER -->
<!-- BEGIN BREADCRUMBS -->

      
      <div id="breadcrumb">
        
<ul class="navigation"><li class="prev"><a accesskey="p" class="prev" href="WSc3ff6d0ea77859461172e0811cbec16809-7ff9.html" title="Event gateway elements"><img src="images/blank.gif" alt="Previous" width="17" height="17" /></a></li><li class="next"><a accesskey="n" class="next" href="WSc3ff6d0ea77859461172e0811cbec22c24-77ef.html" title="Deploying an event gateway"><img src="images/blank.gif" alt="Next" width="17" height="17" /></a></li></ul><div class="hierarchy" id="hierarchy"><a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Home</b></a> / <a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Developing&#160;ColdFusion 9 Applications</b></a> / <a href="WSc3ff6d0ea77859461172e0811cdd865267-8000.html"><b>Using External Resources</b></a> 
      / <a href="WSc3ff6d0ea77859461172e0811cbec22c24-77f3.html"><b>Creating Custom Event Gateways</b></a> 
     </div>

      </div>
<!-- END BREADCRUMBS -->
      <div id="content_wrapper">
<!-- BEGIN PAGE TITLE -->
        <h1>Building an event gateway</h1>
<!-- END PAGE TITLE -->
<!-- BEGIN IONCOMMENTCOUNT -->
        <div id="ionCount">
        </div>
<!-- END IONCOMMENTCOUNT -->
<table id="inner_content_table" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td>
          <div style="border-top:#ccc solid 1px;"><p> </p>
          </div>
<p id="chcPromo" style="display:none;">
<a id="chcLink" href="http://www.adobe.com/support/chc/">
<img id="chcImage" src="http://www.adobe.com/support/chc/GetMoreHelpFeatures.png"/>
</a>
</p>
<script type="text/javascript" language="javascript" charset="utf-8">
<!--
var cfgArray = [];
//cfgArray["Acrobat_10.0_Professional.helpcfg"] = "acrobatpro";
//cfgArray["Acrobat_10.0_Standard.helpcfg"] = "acrobatstd";
cfgArray["Lightroom_3.0.helpcfg"] = "lightroom";
cfgArray["PhotoshopElements_8.0_Win.helpcfg"] = "photoshopelements";
cfgArray["PhotoshopElements_8.0_Mac.helpcfg"] = "photoshopelementsmac";
cfgArray["PremiereElements_8.0_Win.helpcfg"] = "premiereelements";

//cfgArray["AfterEffects_10.0.helpcfg"] = "aftereffects";
//cfgArray["AIR.helpcfg"] = "air";
//cfgArray["ColdFusionBuilder.helpcfg"] = "coldfusion";
//cfgArray["Contribute_6.0.helpcfg"] = "contribute";
//cfgArray["DeviceCentral_3.0.helpcfg"] = "devicecentral";
//cfgArray["Dreamweaver_11.0.helpcfg"] = "dreamweaver";
//cfgArray["EncoreDVD_5.0.helpcfg"] = "encore";
//cfgArray["ExtensionManager_3.0.helpcfg"] = "extension";
//cfgArray["Fireworks_11.0.helpcfg"] = "fireworks";
//cfgArray["Flash_11.0.helpcfg"] = "flash";
//cfgArray["Flex_4.0.helpcfg"] = "flashbuilder";
//cfgArray["FlashCatalyst_1.0.helpcfg"] = "flashcatalyst";
//cfgArray["Illustrator_15.0.helpcfg"] = "illustrator";
//cfgArray["InCopy_7.0.helpcfg"] = "incopy";
//cfgArray["InDesign_7.0.helpcfg"] = "indesign";
//cfgArray["OnLocation_5.0.helpcfg"] = "onlocation";
//cfgArray["Photoshop_12.0.helpcfg"] = "photoshop";
//cfgArray["PremierePro_5.0.helpcfg"] = "premierepro";

function getLangName() {
    var lang = "en-us";
    var metaElements = document.all ?
            document.all.tags('meta') :
            document.getElementsByTagName ?
            document.getElementsByTagName ('meta') : new Array();
    for (var m = 0; m < metaElements.length; m++) {
        if (metaElements[m].name == "lang") {
            lang = metaElements[m].content;
            break;
        }
    }
    var ptn = /(..)-(..)/;
    if (ptn.test(lang)) {
        var languageCode = lang.replace(ptn, "$1");
        var countryCode = lang.replace(ptn, "$2");
        lang = languageCode + "_" + countryCode.toUpperCase();
    }
    return lang;
}

function getCountryName() {
    var lang = "";
    var metaElements = document.all ?
            document.all.tags('meta') :
            document.getElementsByTagName ?
            document.getElementsByTagName ('meta') : new Array();
    for (var m = 0; m < metaElements.length; m++) {
        if (metaElements[m].name == "lang") {
            lang = metaElements[m].content;
            break;
        }
    }
    var ptn = /(..)-(..)/;
    if ((ptn.test(lang)) && (lang != "en-us")) {
        var countryCode = lang.replace(ptn, "$2");
        return "/" + countryCode;
    }
    return "";
}

if ( (typeof(terms_HELPCFG) != 'undefined')  && (terms_HELPCFG.indexOf(".helpcfg") != -1) ) {
    var stage   = (document.location.href.indexOf(".stage.") != -1) ? 'stage.' : '';
    var baseUrl = 'http://www.' + stage + 'adobe.com';
    var refpage = document.location.href.replace(/#.*$/, '');
	
	if ((!use_robohelp_behavior) && (terms_HELPCFG.length > 0) && (typeof(cfgArray[terms_HELPCFG]) != 'undefined') && (cfgArray[terms_HELPCFG].length > 0)) {
		if (document.getElementById) { // DOM3 = IE5, NS6
			var newHref = baseUrl + getCountryName() + "/support/chc/" + "?helpcfg=http://help." + stage + "adobe.com/HelpCfg/" + getLangName() + "/" + terms_HELPCFG + "&url=" + refpage + "&product=" + cfgArray[terms_HELPCFG];
			var newSrc = baseUrl + getCountryName() + "/support/chc/GetMoreHelpFeatures.png";
			document.getElementById("chcPromo").style.display = "block";
			document.getElementById("chcLink").href = newHref;
			document.getElementById("chcImage").src = newSrc;
		}
	}
}

//-->
</script>



          <div id="minitoc"><div class="t"><div class="b"><div><ul id="minitoc-links"><li><p><a href="#WSc3ff6d0ea77859461172e0811cbec22c24-77a9"><span class="topictitle1">Class constructor</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbec22c24-5ef9"><span class="topictitle1">Providing Gateway class service and information routines</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbec16809-7ffe"><span class="topictitle1">Starting, stopping, and restarting the event gateway</span>
</a></p><ul><li><p><a href="#WSf01dbd23413dda0e-599f8e571200f8fb225-7ffe"><span class="topictitle2">The start method</span>
</a></p></li><li><p><a href="#WSf01dbd23413dda0e-599f8e571200f8fb225-7ffd"><span class="topictitle2">The stop method</span>
</a></p></li><li><p><a href="#WSf01dbd23413dda0e-599f8e571200f8fb225-7ffc"><span class="topictitle2">The restart method</span>
</a></p></li></ul></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbec22c24-77b2"><span class="topictitle1">Responding to incoming messages</span>
</a></p></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbec22c24-5ef2"><span class="topictitle1">Responding to a ColdFusion function or listener CFC</span>
</a></p><ul><li><p><a href="#WSf01dbd23413dda0e-599f8e571200f8fb225-7ffb"><span class="topictitle2">Example outgoingMessage method</span>
</a></p></li></ul></li><li><p><a href="#WSc3ff6d0ea77859461172e0811cbec22c24-77b1"><span class="topictitle1">Logging events and using log files</span>
</a></p></li></ul></div></div></div></div><div><p>To build
a Gateway class, you can start with the EmptyGateway.java file as
a template. (In the server configuration, this file is located in
the <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">cf_root</i>/gateway/src/examples/ directory; in the J2EE
configuration, the file is in the <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">cf_root</i>/WEB-INF/cfusion/gateway/src/examples/
directory.) This file defines a nonfunctional event gateway, but
has the basic skeleton code for all Gateway class methods.</p>
<p>Wherever possible, this document uses code based on the sample
Socket event gateway to show how to implement event gateway features.
(In the server configuration, this file is <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">cf_root</i>/gateway/src/examples/socket/SocketGateway.java;
in the J2EE configuration, the file is <i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">cf_root</i>/WEB-INF/cfusion/gateway/src/examples/socket/SocketGateway.java.)</p>
</div>
<div id="WSc3ff6d0ea77859461172e0811cbec22c24-77a9" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbec22c24-77a9"><!-- --></a><h2 class="topictitle2">Class constructor</h2><div><p>An event gateway can implement any of the following constructors:</p>
<ul><li><p><samp class="codeph">MyGateway(String gatewayID, String configurationFile)</samp></p>
</li>
<li><p><samp class="codeph">MyGateway(String gatewayID)</samp></p>
</li>
<li><p><samp class="codeph">MyGateway()</samp></p>
</li>
</ul>
<p>When
ColdFusion starts, it calls the constructor for each event gateway
instance that you configure in ColdFusion. (ColdFusion also calls
the gateway <samp class="codeph">Start</samp> method after the event gateway
is instantiated.). ColdFusion first attempts to use the two-parameter
constructor.</p>
<p>Because each event gateway instance must have a unique ID, ColdFusion provides
redundant support for providing the ID. If the event gateway implements
only the default constructor, ColdFusion provides the ID by calling
the <samp class="codeph">setGatewayID</samp> method of the event gateway. </p>
<p>If the event gateway does not implement the two-parameter constructor,
it does not get configuration file information from ColdFusion.</p>
<p>The constructor normally calls the static GatewayServices.getGatewayServices method
to access ColdFusion event gateway services. Although you need not make
this call, it is a good coding practice.</p>
<p>A minimal constructor that takes only a gateway ID could look
like the following:</p>
<pre>public MyGateway(String gatewayID) { 
    this.gatewayID = gatewayID; 
    this.gatewayService = GatewayServices.getGatewayServices(); 
}</pre>
<p>The gateway constructor must throw a coldfusion.server.ServiceRuntimeException
exception if an error occurs that otherwise cannot be handled. For example,
throw this exception if the event gateway requires a configuration
file and cannot read the file contents. </p>
<p>If your gateway uses a configuration file, have the constructor
load the file, even if the <samp class="codeph">Start</samp> method also loads
the file. Load the file because the constructor does not run in
an independent thread, and ColdFusion can display an error in the
ColdFusion Administrator of the file fails to load. If the <samp class="codeph">Start</samp> method,
which does run in a separate thread, fails to load the file, ColdFusion
logs the error, but it cannot provide immediate feedback in the
administrator.</p>
<p>The sample Socket event gateway has a single constructor that
takes two parameters. It tries to load a configuration file. If
you specify a configuration file in the ColdFusion Administrator,
or the file path is invalid, it gets an IO exception. It then uses
the default port and logs a message indicating what it did. The
following example shows the Gateway constructor code and the <samp class="codeph">loadProperties</samp> method
it uses:</p>
<pre>public SocketGateway(String id, String configpath) 
{ 
    gatewayID = id; 
    gatewayService = GatewayServices.getGatewayServices(); 
    // log things to socket-gateway.log in the CF log directory 
    log = gatewayService.getLogger("socket-gateway"); 
    propsFilePath=configpath; 
    try 
    { 
        FileInputStream propsFile = new FileInputStream(propsFilePath); 
        properties.load(propsFile); 
        propsFile.close(); 
        this.loadProperties(); 
     } 
     catch (IOException e) 
    { 
        // Use default value for port and log the status. 
        log.warn("SocketGateway(" + gatewayID + ") Unable to read configuration  
            file '" + propsFilePath + "': " + e.toString() + ".Using default port 
            " + port + ".", e); 
    } 
} 
 
private void loadProperties() { 
    String tmp = properties.getProperty("port"); 
    port = Integer.parseInt(tmp); 
}</pre>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbec22c24-5ef9" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbec22c24-5ef9"><!-- --></a><h2 class="topictitle2">Providing Gateway class service and information routines</h2><div><p>Several gateway methods perform event gateway
configuration services and provide event gateway information. The
ColdFusion event gateway services call many of these methods to
configure the event gateway by using information stored by the ColdFusion
Administrator, and to get access to resources and information that
the event gateway services and applications require. Some of these methods
can also be useful in event gateway code. The following methods provide
these services and information:</p>
<ul><li><p><samp class="codeph">setCFCListeners</samp></p>
</li>
<li><p><samp class="codeph">setGatewayID</samp></p>
</li>
<li><p><samp class="codeph">getHelper</samp></p>
</li>
<li><p><samp class="codeph">getGatewayID</samp></p>
</li>
<li><p><samp class="codeph">getStatus</samp></p>
</li>
</ul>
<p>ColdFusion calls the <samp class="codeph">setCFCListeners</samp> method
with the CFC or CFCs that are specified in the ColdFusion Administrator
when it starts a gateway. ColdFusion also calls the method in a
running event gateway when the configuration information changes,
so the method must be written to handle such changes. The <samp class="codeph">setCFCListeners</samp> method
must save the listener information so that the gateway code that
dispatches incoming messages to gateway services can use the listener
CFCs in <samp class="codeph">setCFCPath</samp> methods.</p>
<p>ColdFusion calls the <samp class="codeph">setGatewayID</samp> method when
it starts a gateway. The <samp class="codeph">getGatewayID</samp> method must
return the value set by this method. </p>
<p>ColdFusion calls the <samp class="codeph">getHelper</samp> method when an
application calls the CFML <samp class="codeph">GetGatewayHelper</samp> function.</p>
<p>The following code shows how the SocketGateway class defines
these methods. To create a gateway, modify the <samp class="codeph">getHelper</samp> definition
to return the correct class, or to return null if no gateway helper
class exists. Most gateways can leave the other method definitions
unchanged.</p>
<pre>public void setCFCListeners(String[] listeners) { 
    this.listeners = listeners; 
} 
public GatewayHelper getHelper() { 
    // SocketHelper class implements the GatewayHelper interface. 
    return new SocketHelper(); 
} 
public void setGatewayID(String id) { 
    gatewayID = id; 
} 
public String getGatewayID() { 
    return gatewayID; 
} 
public int getStatus() { 
    return status; 
}</pre>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbec16809-7ffe" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbec16809-7ffe"><!-- --></a><h2 class="topictitle2">Starting, stopping, and restarting the event gateway</h2><div><p>Because an event gateway uses at least one
listener thread, it must have <samp class="codeph">start</samp>, <samp class="codeph">stop</samp>,
and <samp class="codeph">restart</samp> methods to control the threads. These
methods must also maintain the status variable that the Gateway
class <samp class="codeph">getStatus</samp> method checks, and change its value
among <samp class="codeph">STARTING</samp>, <samp class="codeph">RUNNING</samp>, <samp class="codeph">STOPPING</samp>, <samp class="codeph">STOPPED</samp>,
and <samp class="codeph">FAILED</samp>, as appropriate.</p>
</div><div id="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffe" class="nochunk"><a name="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffe"><!-- --></a><h3 class="topictitle3">The start method</h3><div><p>The <samp class="codeph">start</samp> method
initializes the event gateway. It starts one or more listener threads
that monitor the event source and respond to any messages it receives from
the source.</p>
<p>The <samp class="codeph">start</samp> method should return within a time-out
period that you can configure for each event gateway type in the
ColdFusion Administrator. If it does not, the ColdFusion Administrator
has a Kill on Startup Timeout option for each gateway type. If you
select the option, and a time-out occurs, the ColdFusion starter
thread calls an interrupt on the gateway thread to try to kill it,
and then exits.</p>
<div class="note"><span class="notetitle">Note:  </span>If the <samp class="codeph">start</samp> method is the
listener (for example, in a single-threaded gateway), the method
does not return until the gateway stops. Do not set the Kill on Startup
Timeout option in the ColdFusion Administrator for such gateways.</div>
<p>If the gateway uses a configuration file, load the configuration
from the file. Doing so lets users change the configuration file
and restart the gateway without restarting ColdFusion. Also load
the configuration file in the constructor; for more information,
see <a href="WSc3ff6d0ea77859461172e0811cbec22c24-77a9.html">Class constructor</a>.</p>
<p>In the SocketGateway class, the <samp class="codeph">start</samp> method
starts an initial thread. (In a single-threaded Gateway, this thread
would be the only one.) When the thread starts, it calls a <samp class="codeph">socketServer</samp> method,
which uses the Java ServerSocket class to implement a multi-threaded
socket listener and message dispatcher. For more information on
the listener, see <a href="WSc3ff6d0ea77859461172e0811cbec22c24-77b2.html">Responding to incoming messages</a>. </p>
<pre>public void start() 
{ 
    status = STARTING; 
    listening=true; 
    // Start up event generator thread 
    Runnable r = new Runnable() 
    { 
        public void run() 
        { 
            socketServer(); 
        } 
    }; 
    Thread t = new Thread(r); 
    t.start(); 
    status = RUNNING; 
}</pre>
</div></div><div id="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffd" class="nochunk"><a name="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffd"><!-- --></a><h3 class="topictitle3">The stop method</h3><div><p>The <samp class="codeph">stop</samp> method
performs the event gateway shutdown tasks, including shutting down
the listener thread or threads and releasing any resources. The following
example shows the SocketGateway <samp class="codeph">stop</samp> method:</p>
<pre>public void stop() 
{ 
    // Set the status variable to indicate that the server is stopping. 
    status = STOPPING; 
    // The listening variable is used as a switch to stop listener activity. 
    listening=false; 
    // Close the listener thread sockets. 
    Enumeration e = socketRegistry.elements(); 
    while (e.hasMoreElements()) { 
        try 
        { 
            ((SocketServerThread)e.nextElement()).socket.close(); 
        } 
        catch (IOException e1) 
        { 
            // We don't care if a close failed. 
            //log.error(e1); 
        } 
    } 
    // Close and release the serverSocket instance that gets requests from the 
    // network. 
    if (serverSocket != null) { 
        try 
        { 
            serverSocket.close(); 
        } 
        catch (IOException e1) 
        { 
        } 
        //Release the serverSocket. 
        serverSocket = null; 
    } 
    // Shutdown succeeded; set the status variable. 
    status = STOPPED; 
}</pre>
</div></div><div id="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffc" class="nochunk"><a name="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffc"><!-- --></a><h3 class="topictitle3">The restart method</h3><div><p>In
most cases, you implement the <samp class="codeph">restart</samp> method by
calling the <samp class="codeph">stop</samp> method and the <samp class="codeph">start</samp> method
consecutively, but you could be able to optimize this process for
some services. The following code shows the SocketGateway class <samp class="codeph">restart</samp> method:</p>
<pre>public void restart() { 
    stop(); 
    start(); 
}</pre>
</div></div></div>
<div id="WSc3ff6d0ea77859461172e0811cbec22c24-77b2" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbec22c24-77b2"><!-- --></a><h2 class="topictitle2">Responding to incoming messages</h2><div><p>One or more
listener threads respond to incoming messages (events). The threads
must include code to dispatch the messages to ColdFusion event gateway
services, as follows:</p>
<ol><li><p>Create a CFEvent instance.</p>
</li>
<li><p>Create a Map instance that contains the message and any other
event gateway-specific information, and pass it to the CFEvent <samp class="codeph">setData</samp> method.</p>
</li>
<li><p>Call the CFEvent <samp class="codeph">setOriginator</samp> method to
specify the source of the message. (This call is required if the
ColdFusion application sends a response.)</p>
</li>
<li><p>Call the CFEvent <samp class="codeph">setGateWayType</samp> method to
specify the event gateway type.</p>
</li>
<li><p>Set any other CFEvent fields where the default behavior is
not appropriate; for example, call the <samp class="codeph">setCFCPath</samp> method
to replace the default listener CFC. (For information on default
CFEvent fields, see <a href="WSc3ff6d0ea77859461172e0811cbec22c24-77ae.html">CFEvent class</a>.)</p>
</li>
<li><p>Call the <samp class="codeph">gatewayService.addEvent</samp> method
to dispatch the CFEvent instance to ColdFusion.</p>
</li>
<li><p>Handle cases where the event is not added to the event gateway
service queue (the <samp class="codeph">addEvent</samp> method returns False).</p>
</li>
</ol>
<p>If your application sends any messages to multiple listener CFCs,
the gateway must create and configure a CFEvent instance and call
the <samp class="codeph">gatewayService.addEvent</samp> method to send the
message to each separate listener CFC. The <samp class="codeph">setCFCListeners</samp> method
of the gateway must make the CFC paths available to the gateway
for configuring the CFEvent instances.</p>
<p>If your ColdFusion server carries a heavy event gateway message
load, the ColdFusion event gateway services event queue could reach
the maximum value set in the ColdFusion Administrator. When the
queue reaches the maximum, the <samp class="codeph">gatewayService.addEvent</samp> method
returns False and fails. Your code can do any of the following:</p>
<ul><li><p>Return a message to the sender to indicate that their
message was not received.</p>
</li>
<li><p>Wait until the queue is available by periodically comparing
the values returned by the GatewayService <samp class="codeph">getQueueSize</samp> and <samp class="codeph">getMaxQueueSize</samp> methods, and
retry the <samp class="codeph">addEvent</samp> method when the queue size is
less than the maximum.</p>
</li>
<li><p>Log the occurrence using the logger returned by the GatewayService <samp class="codeph">getLogger</samp> method.
(For more information, see <a href="WSc3ff6d0ea77859461172e0811cbec22c24-77b1.html">Logging events and using log files</a>.)</p>
</li>
</ul>
<p>The
SocketGateway class implements the listener using a java.net.ServerSocket class
object and SocketServerThread listener threads. (See the SocketGateway source
for the SocketServerThread code.) When the listener thread gets
a message from the TCP/IP socket, it calls the following <samp class="codeph">processInput</samp> method to
dispatch the message to ColdFusion. This method explicitly sets
all required and optional CFEvent fields and sends the event to
ColdFusion. If the <samp class="codeph">addEvent</samp> call fails, it logs
the error.</p>
<div class="note"><span class="notetitle">Note:  </span>Much of the <samp class="codeph">processInput</samp> method
code supports multiple listener CFCs. A gateway that uses only a
single listener CFC, would require only the code in the latter part
of this method. </div>
<pre>private void processInput(String theInput, String theKey) 
{ 
    // Convert listeners list to a local array 
    // Protect ourselves if the list changes while we are running 
    String[] listeners; 
    int size = cfcListeners.size(); 
    if (size &gt; 0) 
    { 
        // Capture the listeners list 
        synchronized (cfcListeners) 
        { 
            listeners = new String[size]; 
            cfcListeners.toArray(listeners); 
        } 
    } 
    else 
    { 
        // Create a dummy list 
        listeners = new String[1]; 
        listeners[0] = null; 
    } 
    // Broadcast to all the CFC listeners 
    // Send one message at a time with different CFC address on them 
    for (int i = 0; i &lt; listeners.length; i++) 
    { 
        String path = listeners[i]; 
        CFEvent event = new CFEvent(gatewayID); 
        Hashtable mydata = new Hashtable(); 
        mydata.put("MESSAGE", theInput); 
        event.setData(mydata); 
        event.setGatewayType("SocketGateway"); 
        event.setOriginatorID(theKey); 
        event.setCfcMethod(cfcEntryPoint); 
        event.setCfcTimeOut(10); 
        if (path != null) 
            event.setCfcPath(path); 
            boolean sent = gatewayService.addEvent(event); 
        if (!sent) 
            log.error("SocketGateway(" + gatewayID + ") Unable to place message on 
                event queue. Message not sent from " + gatewayID + ", thread " + theKey 
                + ".Message was " + theInput); 
    } 
}</pre>
</div></div>
<div id="WSc3ff6d0ea77859461172e0811cbec22c24-5ef2" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbec22c24-5ef2"><!-- --></a><h2 class="topictitle2">Responding to a ColdFusion function or listener CFC</h2><div><p>The
ColdFusion event gateway services call the <samp class="codeph">outgoingMessage</samp> method
of the gateway to handle messages generated when the listener method
of an event gateway application listener CFC returns a message or
any CFML code calls a <samp class="codeph">SendGatewayMessage</samp> function.
This method must send the message to the appropriate external resource.</p>
<p>The <samp class="codeph">outgoingMessage</samp> method
parameter is a CFEvent instance, containing the information about
the message to send out. The CFEvent <samp class="codeph">getData</samp> method returns
a Map object that contains event gateway-specific information about
the message, including any message text. All CFEvent instances received
by the outgoingMessage contain information in the Data and GatewayID
fields. </p>
<p>CFEvent instances returned from listener CFC <samp class="codeph">onIncomingMessage</samp> methods include
the originator ID of the incoming message and other information. However,
a gateway that could handle messages from the ColdFusion <samp class="codeph">SendGatewayMessage</samp> function
cannot rely on this information being available, so it is good practice
to require that all outgoing messages include the destination ID
in the data Map.</p>
<p>The <samp class="codeph">outgoingMessage</samp> method returns a String
value. The CFML <samp class="codeph">sendGatewayMessage</samp> function returns
this value to the ColdFusion application. Indicate the status of
the message in the returned string. By convention, ColdFusion event
gateway <samp class="codeph">outgoingMessage</samp> methods return “OK” if
they do not encounter errors and do not have additional information
(such as a message ID) to return.</p>
<p>Because event messages are asynchronous, a positive return normally
does not indicate that the message was successful delivered, only
that the <samp class="codeph">outgoingMessage</samp> method successfully handled
the message. In some cases, however, it is possible to make the <samp class="codeph">outgoingMessage</samp> method
at least partially synchronous. The SMS gateway, for example, provides
two <samp class="codeph">outgoingMessage</samp> modes:</p>
<dl><dt class="dlterm">Asynchronous mode</dt>
<dd xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">The <samp class="codeph">outgoingMessage</samp> method
returns when the message is queued internally for delivery to the
short message service center (SMSC) of the messaging provider.</dd><p class="dlseparator"></p><dt class="dlterm">Synchronous mode</dt>
<dd xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">The method does not return until the message is delivered to
the SMSC, or an error occurs.<p>This way, an SMS application
can get a message ID for later use, such as to compare with a message
receipt.</p>
</dd><p class="dlseparator"></p></dl>
</div><div id="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffb" class="nochunk"><a name="WSf01dbd23413dda0e-599f8e571200f8fb225-7ffb"><!-- --></a><h3 class="topictitle3">Example outgoingMessage method</h3><div><p>The
following outgoingMessage method is like the version in the SocketGateway class.
It does the following: </p>
<ol><li><p>Gets the contents of a MESSAGE field of the Data Map
returned by the CFEvent class <samp class="codeph">getData</samp> method.</p>
</li>
<li><p>Gets the destination from an <samp class="codeph">outDestID</samp> field
in the data Map. </p>
</li>
<li><p>Uses the socket server thread of the destination to write
the message.</p>
</li>
</ol>
<pre>public String outgoingMessage(coldfusion.eventgateway.CFEvent cfmsg) { 
    String retcode="ok"; 
    // Get the table of data returned from the event handler 
    Map data = cfmsg.getData(); 
    String message = (String) data.get("MESSAGE"); 
    // Find the right socket to write to from the socketRegistry hash table 
    // and call the writeoutput method of the socket thread. 
    // (Get the destination ID from the data map.) 
    if (data.get("outDestID") != null) 
        ((SocketServerThread)socketRegistry.get(data.get("outDestID"))). 
                writeOutput(message); 
    else { 
        System.out.println("cannot send outgoing message. OriginatorID is not 
            available."); 
        retcode="failed"; 
        } 
    return retcode; 
}</pre>
</div></div></div>
<div id="WSc3ff6d0ea77859461172e0811cbec22c24-77b1" class="nochunk"><a name="WSc3ff6d0ea77859461172e0811cbec22c24-77b1"><!-- --></a><h2 class="topictitle2">Logging events and using log files</h2><div><p>The <samp class="codeph">GatewayServices.getLogger</samp> method
returns an instance of the coldfusion.eventgateway.Logger class
that you can use to log messages to a file in the ColdFusion logs
directory. (You set this directory on the ColdFusion Administrator
Logging Settings page.) The method can take no parameter, or one parameter:</p>
<ul><li><p>The default <samp class="codeph">GatewayServices.getLogger</samp> method
uses the eventgateway.log file. </p>
</li>
<li><p>Optionally, you can specify a log filename, without the .log
extension or directory path. </p>
</li>
</ul>
<p>The following example tells ColdFusion to log messages from the
gateway to the mygateway.log file in the ColdFusion logs directory:</p>
<pre>coldfusion.eventgateway.Logger log =getGatewayServices().getLogger("mygateway");</pre>
<p>The Logger
class has the following methods, all of which take a message string. The
method you use determines severity level that is set in the log
message.</p>
<ul><li><p><samp class="codeph">info</samp></p>
</li>
<li><p><samp class="codeph">warn</samp></p>
</li>
<li><p><samp class="codeph">error</samp></p>
</li>
<li><p><samp class="codeph">fatal</samp></p>
</li>
</ul>
<p>You can also pass these methods an exception instance as a second
parameter. When you pass an exception, ColdFusion places the exception
information in the exception.log file in the ColdFusion logs directory.</p>
<p>You can use these methods to log any messages that you find appropriate.
If you use the default eventgateway.log file, however, remember
that all ColdFusion standard gateways us it, and other gateways
could use it. As a result, limit the messages that you normally
log to this file to infrequent normal occurrences (such as gateway
startup and shutdown) or errors for which you want to retain data. </p>
<p>ColdFusion uses the following format for the message text, so
have your application follow this pattern:</p>
<pre><i xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xs="http://www.w3.org/2001/XMLSchema">GatewayType (Gateway ID) Message</i></pre>
<p>The SMS event gateway, for example, includes the following exception
catching code, which logs a general exception messages and the exception
name in the eventgateway.log file, and also (automatically) logs
the exception in the exceptions.log file:</p>
<pre>catch(Exception e) 
{ 
    logger.error("SMSGateway (" + gatewayID + ") Exception while processing 
    incoming event: " + e, e); 
}</pre>
<div class="note"><span class="notetitle">Note:  </span>When you are developing an event gateway application,
you can use the ColdFusion Log viewer to inspect your log files
and the standard ColdFusion log files, including the eventgateway.log
file and exception.log file. You can use the viewer to filter the
display, for example, by selecting different severity levels, or
searching for keywords.</div>
</div></div>


<!-- BEGIN USER PREFERENCES -->
          <div id="userprefs">
          </div>
<!-- END USER PREFERENCES -->

          <div id="related">
            
            
            <div class="separator"><a href="#top"><img src="images/BTT.jpg" /></a>&#160;</div>
          </div>
          <div id="footer">
<!-- BEGIN IONCOMMENTS -->
            <div id="ionComHere">
            </div>
<!-- END IONCOMMENTS -->


            <p id="creativecommons"><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" id="creativecommons_text"><img id="creativecommons_img" src="images/CC.png" alt="This work is licensed under a Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License" /></a>&nbsp;Twitter™ and Facebook posts are not covered under the terms of Creative Commons.</p>
          </div>
</td>
<td width="10px"></td>
<td id="inner_rightcolumn">

</td></tr></table>
      </div>
<!-- BEGIN BREADCRUMBS -->
      <div id="breadcrumb">
        
<ul class="navigation"><li class="prev"><a accesskey="p" class="prev" href="WSc3ff6d0ea77859461172e0811cbec16809-7ff9.html" title="Event gateway elements"><img src="images/blank.gif" alt="Previous" width="17" height="17" /></a></li><li class="next"><a accesskey="n" class="next" href="WSc3ff6d0ea77859461172e0811cbec22c24-77ef.html" title="Deploying an event gateway"><img src="images/blank.gif" alt="Next" width="17" height="17" /></a></li></ul><div class="hierarchy" id="hierarchy"><a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Home</b></a> / <a href="WSf01dbd23413dda0e-446b5201205757ce2b-8000.html"><b>Developing&#160;ColdFusion 9 Applications</b></a> / <a href="WSc3ff6d0ea77859461172e0811cdd865267-8000.html"><b>Using External Resources</b></a> 
      / <a href="WSc3ff6d0ea77859461172e0811cbec22c24-77f3.html"><b>Creating Custom Event Gateways</b></a> 
     </div>

      </div>
<!-- END BREADCRUMBS -->
<!-- END CONTENT WRAPPER -->

</td>
<td id="col3">
    <div>
        <img src="images/adobe-lq.png" />
    </div>
</td>
</tr>
</table>
    </div>
<!-- END PAGE CONTENT WRAPPER -->
<script type="text/javascript">
<!--[CDATA[
scrollToNameAnchor();
// ]]-->
</script> 
<!--
    Description:
    This file generates the link to product support in the top right corner
-->

<style>
#menutop{
    position:absolute;
    top:4px;
    right:24px;
    width:auto;    
    font-size:11px;
    color:#fff;
    text-align:right;
}
#menutop a{
    color:#fff;
}
#menutop a:hover{
        text-decoration:underline;
}
</style>  
  
  
  
  
<div id="productmenu">
<!--googleoff: index-->
  <div id="menutop">


<script language=javascript type='text/javascript'>
    // darken menu text for products with light backgrounds
    var path = document.location.href.toLowerCase();
    if (path.indexOf("/acrobat/")           	> 0 ||
        path.indexOf("/acrobat.com/")       	> 0 ||
        path.indexOf("/acrobatConnectPro/") 	> 0 ||
        path.indexOf("/connect/")           	> 0 ||
        path.indexOf("/livecycledataserviceses/") > 0 ||
        path.indexOf("/muse/")         	> 0 ||
	path.indexOf("/presenter/")         	> 0 ||
        path.indexOf("/scene7/")            	> 0 ||
        path.indexOf("/flashmediaserver/")  	> 0 ||
        path.indexOf("/wave/")              	> 0 )
    {
        document.write('<style>#menutop a{color:#505050}</style>');
    }
    if (typeof('terms_AHV_PRODUCT_SUPPORT') != "undefined" && ! use_robohelp_behavior ){      
        if (path.indexOf("/muse/") > -1 ){
            var supportlink = '<a href="http://muse.adobe.com/support.html">'+terms_AHV_PRODUCT_SUPPORT+'</a>';
        }else{
            var supportlink = '<a href="http://adobe.com/support">'+terms_AHV_PRODUCT_SUPPORT+'</a>';
        }
        document.write( supportlink );
     }

</script> 

  </div>
<!--googleon: index-->
</div>



<style>
#online-privacy-policy{ 
    margin:10px 40px; 
    font-size:11px;
}
</style>

<p id="online-privacy-policy">
<script language="javascript">
var pageLoc = "en_US";
var metaElements = document.all ?
document.all.tags('meta') :
document.getElementsByTagName ?
document.getElementsByTagName ('meta') : new Array();
for (var m = 0; m < metaElements.length; m++) {
	if (metaElements[m].name == "lang") {
		pageLoc = metaElements[m].content;
		break;
	}
}
var ptn = /(..)-(..)/;
if (ptn.test(pageLoc)) {
	var languageCode = pageLoc.replace(ptn, "$1");
	var countryCode = pageLoc.replace(ptn, "$2");
	pageLoc = languageCode + "_" + countryCode.toUpperCase();
}

var policyLoc = "en_US";
var policyText = "Online Privacy Policy";
var policyPath = "";
var policyArray=[
"da_DK", "Online fortrolighedserklæring",
"de_DE", "Online-Datenschutzrichtlinie",
"es_ES", "Política de confidencialidad en línea",
"fi_FI", "Yksityisyyttä koskeva Online-toimintaohjelma",
"fr_FR", "Confidentialité et sécurité",
"it_IT", "Informativa sulla privacy online",
"ja_JP", "プライバシーポリシー",
"ko_KR", "Adobe 온라인 개인정보 보호정책",
"pt_BR", "Política de Confidencialidade On-line", 
"zh_CN", "在线隐私政策",
"zh_TW", "線上隱私政策"
];
var legalLoc = "en_US";
var legalText = "Legal Notices";
var legalPath = legalLoc;
var legalArray=[
"ar_AE", "إشعارات قانونية",
"bg_BG", "Юридически бележки",
"cs_CZ", "Právní upozornění",
"da_DK", "Juridiske meddelelser",
"de_DE", "Rechtliche Hinweise",
"el_GR", "Σημειώσεις νομικού περιεχομένου",
"es_ES", "Avisos legales",
"et_EE", "Juriidilised teated",
"fi_FI", "Lakisääteiset ilmoitukset",
"fr_FR", "Mentions légales",
"he_IL", "הצהרות משפטיות",
"hr_HR", "Pravne napomene",
"hu_HU", "Jogi közlemények",
"it_IT", "Informazioni legali",
"ja_JP", "法律上の注意",
"ko_KR", "법적 고지 사항",
"lt_LT", "Teisinės pastabos",
"lv_LV", "Juridisks paziņojums",
"nb_NO", "Juridiske merknader",
"nl_NL", "Juridische kennisgevingen",
"pl_PL", "Informacje prawne",
"pt_BR", "Aspectos jurídicos",
"ro_RO", "Prevederi legale",
"ru_RU", "Юридическая информация",
"sk_SK", "Právne upozornenie",
"sl_SI", "Pravni pouk",
"sv_SE", "Upphovsrätt",
"tr_TR", "Yasal uyarılar",
"uk_UA", "Юридична інформація",
"zh_CN", "法律声明",
"zh_TW", "法律注意事項"
];

ruPolicy = "http://www.adobe.com/ru/misc/privacy.html";
trPolicy = "http://www.adobe.com/tr/misc/privacy.html";

// Bug 2846992: LOC: RUS, TUR: The link to "Online Privacy Policy" should include language, currently it is not appearing.
if (pageLoc == "ru_RU") {
	policyPath = "ru";
}
else if (pageLoc == "tr_TR") {
	policyPath = "tr";
}
for (var i = 0; i < policyArray.length; i+=2) {
	if (pageLoc == policyArray[i]) {
		policyLoc = pageLoc;
		policyText = policyArray[i+1];
		var ptn = /(..)_(..)/;
		if (ptn.test(policyLoc)) {
			var countryCode = policyLoc.replace(ptn, "$2");
			policyPath = countryCode.toLowerCase();
		}
		break;
	}
}

for (var i = 0; i < legalArray.length; i+=2) {
	if (pageLoc == legalArray[i]) {
		legalLoc = pageLoc;
		legalText = legalArray[i+1];
		legalPath = legalLoc;
		break;
	}
}
if(agt.indexOf("community help client") > -1 ){
	document.write('<a href="/'+legalPath+'/legalnotices/index.html">'+legalText+'<\/a>');
	document.write(' | ');
	document.write('<a href="http://www.adobe.com/'+policyPath+'/misc/privacy.html">'+policyText+'<\/a>');
}else{
	//Open the privacy policy in a new window
	document.write('<a target="_blank" href="/'+legalPath+'/legalnotices/index.html">'+legalText+'<\/a>');
	document.write(' | ');
	document.write('<a target="_blank" href="http://www.adobe.com/'+policyPath+'/misc/privacy.html">'+policyText+'<\/a>');
} 
</script>
</p>



<!-- localfooter.ssi -->

<script type="text/javascript">
    var debug = (top.location.href.indexOf("debug=true") > -1);
</script>

<script language="javascript">
document.write('<scr'+'ipt ' +
               'src="/en_US/ssi/_pod.js" ' +
               'language="javascript" ' +
               'charset="UTF-8"> ' +
               '</scr'+'ipt>');
</script>


<script type="text/javascript">
//
//  Ethnio survey code
//
/*          DocumentID      EthnioID */
/*          -------------   -------- */
var ethnio=["/en_US/flash/cs/using/WSb03e830bd6f770ee6664507612436d7dede-8000.html", "87462",
            "/en_US/creativesuite/cs/using/WSe851854fd1e0856a-4b08a77612477f69f15-8000.html",  "10441",
            "/en_US/dreamweaver/cs/using/WSEE4C0148-A6F4-4bf5-9DEF-CE06AB026214a.html",  "57412"
 
    ];
                        
    for ( var i = 0; i < ethnio.length ; i = i+2 ){
        if ( document.location.href.indexOf( ethnio[i] ) > -1 ){ 
            var headID = document.getElementsByTagName("head")[0];         
            var ethnioScript = document.createElement('script');
            ethnioScript.type = 'text/javascript';
            ethnioScript.src = 'http://ethn.io/remotes/' + ethnio[i+1];        
            if ( debug ){
                alert ("Using Ethnio script: " + ethnioScript.src );
            }else{
                headID.appendChild(ethnioScript);
            }
        }
    }
</script>



<div style="display: none;">
<!-- SiteCatalyst -->
<script language="JavaScript" type="text/javascript"><!--
var s_code=' ';
var s_docHost = window.location.hostname.toLowerCase();
var s_docURL = window.location.pathname.toLowerCase();
var scJsHost = (("https:" == document.location.protocol) ? "https://www.adobe.com" : "http://wwwimages.adobe.com");
if (s_docHost.indexOf(".corp.adobe") != -1 || s_docHost.indexOf("stage.") != -1 || s_docHost.indexOf(".dev.adobe") != -1 || s_docHost.indexOf("staging.") != -1) scJsHost="";
document.write(unescape("%3Cscript src='" + scJsHost + "/uber/js/omniture_s_code.js' type='text/javascript'%3E%3C/script%3E"));
//--></script>
<script type="text/javascript"><!--
var s_accountName;
s_server="www.adobe.com static content pages";
if (!window.s_account) s_accountName="mxmacromedia";
else s_accountName=window.s_account;

if (window.s_docURL.indexOf("/designcenter/") != -1)
  s_channel="Adobe Design Center";	
else if ((window.s_docHost.indexOf("labs.adobe") != -1) ||
(window.s_docHost.indexOf("labs-staging.") != -1))
  s_channel="Labs";
else if (window.s_docHost.indexOf("help.adobe.com") != -1) {
  s_channel="Support Help.adobe.com";
  if (window.s_docURL.indexOf("/en_us/") == -1) {
    s_docURLArray=s_docURL.split('/');
    s_pageName="http://help.adobe.com/"+s_docURLArray[1]+"/"+ s_docURLArray[2]+"/"+s_docURLArray[3];
    s_prop23="http://help.adobe.com"+window.location.pathname;
  }
}
else if (window.s_docHost.indexOf("kb2.adobe.com") != -1) {
  s_channel="Support Knowledgebase";
  s_prop23="http://kb2.adobe.com"+s_docURL+":";
  if (typeof(omtrProductList) != 'undefined' && omtrProductList.length > 0)
 {
    s_prop23=s_prop23+omtrProductList;
  }
}
else if (window.s_docHost.indexOf("resellers.adobe.com") != -1) {
		var s_pageName=document.getElementsByTagName("title")[0].text;
}

if (!window.scMMInclude) {
	var s_wd=window,s_tm=new Date;
	if(s_code!=' '){
		s_code=s_dc(s_accountName);
		if(s_code)document.write(s_code)
	} 
} else {
	s_wds(s_accountName);s_ca(s_accountName); 
}	

function sendAnalyticsEvent(str){var ns=s_accountName;if(str!=null)ns+=","+str;void(s_gs(ns));}
function sendLinkEvent(accnt,lnkname,type){
accnt=s_accountName;s_linkType=type;s_lnk=true;s_linkName=lnkname;void(s_gs(accnt));}
//--></script>
<noscript><img src="http://stats.adobe.com/b/ss/mxmacromedia/1/H.15-XELvs/0?pageName=http%3A//www.adobe.com%3A%20noscript&ch=http%3A//www.adobe.com%3A%20noscript&g=http%3A//www.adobe.com" height="1" width="1" border="0" alt="" /></noscript>
<!-- End SiteCatalyst -->
</div>

<script language="JavaScript" type="text/javascript">//<![CDATA[
var scJsHost = (("https:" == document.location.protocol) ? "https://www.adobe.com" : "http://wwwimages.adobe.com");
document.write(unescape("%3Cscript src='" + scJsHost + "/uber/js/atm/s_code_www.js' type='text/javascript'%3E%3C/script%3E"));
//]]></script>
<script type="text/javascript">//<![CDATA[
if(s_adobe){	
	s_adobe.server="www.adobe.com Static Content pages";
	/* Set pageName */
	s_adobe.s_URL="adobe.com"+((location.pathname.charAt(0)=='/')?location.pathname:'/'+location.pathname);
	if (s_adobe.s_URL.substring(s_adobe.s_URL.lastIndexOf('/')+1)=="") s_adobe.s_URL=s_adobe.s_URL+"index.html";
	s_adobe.s_URLSplit=s_adobe.s_URL.split("/");
	s_adobe.pageName=s_adobe.s_URLSplit.join(":");

	/* Set prop4 to language-locale */
	var s_meta=document.getElementsByTagName('meta'); 
      for (i=0; i<s_meta.length; i++) { 
        if (s_meta[i].getAttribute("http-equiv") == "Content-Language") { 
          s_adobe.prop4=s_meta[i].getAttribute("content"); 
	    s_adobe.prop4=s_adobe.prop4.replace(/\s+/g,'');
        } 
      } 
	s_adobe.t()
}
//]]></script>








  </body>
</html>